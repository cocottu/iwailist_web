# 祝い品管理Webアプリケーション 要件定義

## 1. プロジェクト概要

### 1.1 目的
個人的な祝い品の受け取りとお返しを管理するWebアプリケーションを開発する。

### 1.2 技術スタック
- **フロントエンド**: React + TypeScript (Vite)
- **PWA対応**: Service Worker
- **ローカルストレージ**: IndexedDB
- **バックエンド**: Firebase (無料枠: Spark Plan)
  - Firestore Database: 1GB ストレージ、50K 読み取り/日、20K 書き込み/日
  - Authentication: 無制限
  - Storage: 5GB
  - Hosting: 10GB/月
- **認証**: Firebase Authentication

### 1.3 対象ユーザー
個人ユーザー(マルチデバイス対応)

## 2. 機能要件

### 2.1 贈答品登録・管理機能
- **登録項目**:
  - 贈答品名
  - 贈り主(人物管理と連携)
  - 受け取り日
  - 金額(概算可)
  - カテゴリ(結婚祝い、出産祝い、お見舞い等)
  - 写真(複数枚)
  - メモ
  - お返し状況(未対応/対応済/不要)
- **操作**:
  - 新規登録、編集、削除
  - 検索・フィルタリング(贈り主、カテゴリ、日付、お返し状況)
  - 一覧表示(リスト/カード表示)

### 2.2 写真撮影・解析機能
- **カメラ撮影**: ブラウザのカメラAPI(`getUserMedia`)を使用
- **画像保存**: IndexedDBに保存(Blob形式)
- **プレビュー**: サムネイル表示
- **将来拡張**: OCR/AI解析は将来機能として要件のみ記載

### 2.3 人物管理機能
- **登録項目**:
  - 氏名
  - フリガナ
  - 関係性(親戚、友人、会社関係等)
  - 連絡先(任意)
  - メモ
- **操作**:
  - 新規登録、編集、削除
  - 検索
  - 贈答品履歴の確認

### 2.4 お返し管理機能
- **お返し記録**:
  - お返し品名
  - お返し日
  - 金額
  - 写真
  - メモ
- **ステータス管理**: 未対応 → 対応済への更新
- **お返しリスト**: お返しが必要な贈答品の一覧表示

### 2.5 リマインダー機能
- **通知設定**:
  - お返し期限のリマインダー(受け取りから1ヶ月後など)
  - カスタム通知日設定
- **通知方法**: ブラウザ通知(Service Worker + Notifications API)

### 2.6 統計・分析機能
- **集計**:
  - 期間別の受け取り金額合計
  - 人物別の贈答品履歴
  - カテゴリ別の集計
  - お返し率(対応済/全体)
- **可視化**: グラフ表示(Chart.js等)

### 2.7 広告表示機能
- **現状**: 要件のみ記載、実装は将来
- **想定**: Google AdSense統合
- **配置**: 侵入的でない位置(ページ下部等)

## 3. 非機能要件

### 3.1 オフライン対応
- **Service Worker**: アプリケーションシェルのキャッシュ
- **IndexedDB**: 全データのローカル保存
- **Background Sync**: オンライン復帰時の自動同期

### 3.2 データ同期
- **同期戦略**: オフラインファースト
  - 全操作はまずIndexedDBに保存
  - オンライン時にFirestoreと双方向同期
  - 競合解決: タイムスタンプベース(最新優先)

### 3.3 認証・セキュリティ
- **認証方式**: Firebase Authentication
  - Email/Password
  - Google OAuth
- **データ保護**: Firestore Security Rulesでユーザーごとのアクセス制御

### 3.4 パフォーマンス
- **初回読み込み**: 3秒以内
- **画像最適化**: 圧縮・リサイズ処理
- **遅延読み込み**: 画像・コンポーネントの動的ロード

### 3.5 レスポンシブデザイン
- **対応デバイス**: スマートフォン、タブレット、PC
- **UI/UX**: モダンで直感的なインターフェース

## 4. システム構成

### 4.1 アーキテクチャ
```
[ブラウザ]
  ├─ React UI
  ├─ Service Worker (キャッシュ・同期)
  └─ IndexedDB (ローカルストレージ)
       ↕ (同期)
[Firebase]
  ├─ Authentication (認証)
  ├─ Firestore (クラウドDB)
  ├─ Storage (画像保存)
  └─ Hosting (デプロイ)
```

### 4.2 データモデル
- **Users**: ユーザー情報
- **Persons**: 人物情報
- **Gifts**: 贈答品情報
- **Returns**: お返し情報
- **Reminders**: リマインダー情報

## 5. 開発フェーズ

### Phase 1: 基本機能 (✅ 実装完了)
- ✅ 贈答品登録・管理（一覧、詳細、編集、削除）
- ✅ 人物管理（一覧、詳細、編集、削除）
- ✅ ローカルストレージ(IndexedDB)
- ✅ ダッシュボード（統計情報表示）
- ✅ 統計・分析機能
- ✅ レスポンシブデザイン

### Phase 2: PWA対応 (🔄 次期実装予定)
- Service Worker実装
- オフライン動作
- カメラ撮影機能（写真撮影、画像保存）

### Phase 3: クラウド同期
- Firebase統合
- 認証機能
- データ同期

### Phase 4: 高度な機能
- お返し管理
- リマインダー
- 詳細分析

### Phase 5: 将来機能
- 広告表示
- OCR/AI解析
- 複数人での共有機能

## 6. コスト試算

### Firebase Spark Plan (無料枠)
- **月額**: $0
- **制約**:
  - Firestore読み取り: 50K/日 (約1,500K/月)
  - Firestore書き込み: 20K/日 (約600K/月)
  - Storage: 5GB
- **想定使用量**(個人利用):
  - 読み取り: ~5K/月 ✓
  - 書き込み: ~2K/月 ✓
  - 画像: ~500MB ✓

**結論**: 個人開発では無料枠内で十分運用可能
